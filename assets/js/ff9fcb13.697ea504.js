"use strict";(self.webpackChunklm_commons=self.webpackChunklm_commons||[]).push([[9973],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=u(n),m=o,h=d["".concat(s,".").concat(m)]||d[m]||p[m]||i;return n?r.createElement(h,a(a({ref:t},c),{},{components:n})):r.createElement(h,a({ref:t},c))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,a=new Array(i);a[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,a[1]=l;for(var u=2;u<i;u++)a[u]=n[u];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},3e3:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>a,default:()=>p,frontMatter:()=>i,metadata:()=>l,toc:()=>u});var r=n(7462),o=(n(7294),n(3905));const i={},a="Guide",l={unversionedId:"lmc-cors/guide",id:"lmc-cors/guide",title:"Guide",description:"Event registration",source:"@site/docs/lmc-cors/03-guide.md",sourceDirName:"lmc-cors",slug:"/lmc-cors/guide",permalink:"/docs/lmc-cors/guide",draft:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Installation",permalink:"/docs/lmc-cors/installation"},next:{title:"LmcAdmin",permalink:"/docs/category/lmcadmin"}},s={},u=[{value:"Event registration",id:"event-registration",level:2},{value:"Configuring the module",id:"configuring-the-module",level:2},{value:"Preflight request",id:"preflight-request",level:2},{value:"Actual request",id:"actual-request",level:2},{value:"Security concerns",id:"security-concerns",level:2},{value:"Custom schemes",id:"custom-schemes",level:2},{value:"Example",id:"example",level:2}],c={toc:u};function p(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"guide"},"Guide"),(0,o.kt)("h2",{id:"event-registration"},"Event registration"),(0,o.kt)("p",null,"LmcCors registers the ",(0,o.kt)("inlineCode",{parentName:"p"},"LmcCors\\Mvc\\CorsRequestListener")," with the ",(0,o.kt)("inlineCode",{parentName:"p"},"MvcEvent::EVENT_ROUTE")," event, with a priority\nof -1. This means that this listener is executed AFTER the route has been matched."),(0,o.kt)("h2",{id:"configuring-the-module"},"Configuring the module"),(0,o.kt)("p",null,"As by default, all the various options are set globally for all routes:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"allowed_origins"),": (array) List of allowed origins. To allow any origin, you can use the wildcard (",(0,o.kt)("inlineCode",{parentName:"li"},"*"),") character. If\nmultiple origins are specified, LmcCors will automatically check the ",(0,o.kt)("inlineCode",{parentName:"li"},'"Origin"')," header's value, and only return the\nallowed domain (if any) in the ",(0,o.kt)("inlineCode",{parentName:"li"},'"Allow-Access-Control-Origin"')," response header. To allow any sub-domain, you can prefix\nthe domain with the wildcard character (i.e. ",(0,o.kt)("inlineCode",{parentName:"li"},"*.example.com"),'). Please note that you don\'t need to\nadd your host URI (so if your website is hosted as "example.com", "example.com" is automatically allowed.'),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"allowed_methods"),": (array) List of allowed HTTP methods. Those methods will be returned for the preflight request to\nindicate which methods are allowed to the user agent. You can even specify custom HTTP verbs."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"allowed_headers"),": (array) List of allowed headers that will be returned for the preflight request. This indicates\nto the user agent which headers are permitted to be sent when doing the actual request."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"max_age"),": (int) Maximum age (seconds) the preflight request should be cached by the user agent. This prevents the\nuser agent from sending a preflight request for each request."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"exposed_headers"),": (array) List of response headers that are allowed to be read in the user agent. Please note that\nsome browsers do not implement this feature correctly."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"allowed_credentials"),": (boolean) If true, it allows the browser to send cookies along with the request.")),(0,o.kt)("p",null,"If you want to configure specific routes, you can add ",(0,o.kt)("inlineCode",{parentName:"p"},"ZfrCors\\Options\\CorsOptions::ROUTE_PARAM")," to your route configuration:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"<?php\n\nreturn [\n    'lmc_cors' => [\n        'allowed_origins' => ['*'],\n        'allowed_methods' => ['GET', 'POST', 'DELETE'],\n    ],\n    'router' => [\n        'routes' => [\n            'readOnlyRoute' => [\n                'type' => 'literal',\n                'options' => [\n                    'route' => '/foo/bar',\n                    'defaults' => [\n                        // This will replace allowed_methods configuration to only allow GET requests\n                        // and only allow a specific origin instead of the wildcard origin\n                        LmcCors\\Options\\CorsOptions::ROUTE_PARAM => [\n                            'allowed_origins' => ['http://example.org'],\n                            'allowed_methods' => ['GET'],\n                        ],\n                    ],\n                ],\n            ],\n            'someAjaxCalls' => [\n                'type' => 'literal',\n                'options' => [\n                    'route' => '/ajax',\n                    'defaults' => [\n                        // This overrides the wildcard origin\n                        LmcCors\\Options\\CorsOptions::ROUTE_PARAM => [\n                            'allowed_origins' => ['http://example.org'],\n                        ],\n                    ],\n                ],\n                'may_terminate' => false,\n                'child_routes' => [\n                    'blog' => [\n                        'type' => 'literal',\n                        'options' => [\n                            'route' => '/blogpost',\n                            'defaults' => [\n                                // This would only allow `http://example.org` to GET this route\n                                \\LmcCors\\Options\\CorsOptions::ROUTE_PARAM => [\n                                    'allowed_methods' => ['GET'],\n                                ],\n                            ],\n                        ],\n                        'may_terminate' => true,\n                        'child_routes' => [\n                            'delete' => [\n                                'type' => 'segment',\n                                'options' => [\n                                    'route' => ':id',\n                                    // This would only allow origin `http://example.org` to apply DELETE on this route\n                                    'defaults' => [\n                                        \\LmcCors\\Options\\CorsOptions::ROUTE_PARAM => [\n                                            'allowed_methods' => ['DELETE'],\n                                        ],\n                                    ],\n                                ],\n                            ],\n                        ],\n                    ],\n                ],\n            ],\n        ],\n    ],\n];\n")),(0,o.kt)("h2",{id:"preflight-request"},"Preflight request"),(0,o.kt)("p",null,"If LmcCors detects a preflight CORS request, a new HTTP response will be created, and LmcCors will send the appropriate\nheaders according to your configuration. The response will always be sent with a 200 status code (OK)."),(0,o.kt)("p",null,"Please note that this will also prevent further MVC steps from being executed, since all subsequent MVC steps are\nskipped till ",(0,o.kt)("inlineCode",{parentName:"p"},"Laminas\\Mvc\\MvcEvent::EVENT_FINISH"),", which is responsible for actually sending the response."),(0,o.kt)("h2",{id:"actual-request"},"Actual request"),(0,o.kt)("p",null,"When an actual request is made, LmcCors first checks it the origin is allowed. If it is not, then a new response with\na 403 status code (Forbidden) is created and sent."),(0,o.kt)("p",null,"Please note that this will also prevent further MVC steps from being executed, since all subsequent MVC steps are\nskipped till ",(0,o.kt)("inlineCode",{parentName:"p"},"Laminas\\Mvc\\MvcEvent::EVENT_FINISH"),", which is responsible for actually sending the response."),(0,o.kt)("p",null,"If the origin is allowed, LmcCors will just add the appropriate headers to the request produced by ",(0,o.kt)("inlineCode",{parentName:"p"},"Laminas\\Mvc"),"."),(0,o.kt)("h2",{id:"security-concerns"},"Security concerns"),(0,o.kt)("p",null,"Don't use this module to secure your application! You must use a proper authorization module, like\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/bjyoungblood/BjyAuthorize"},"BjyAuthorize"),", ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/LM-Commons/LmcRbacMvc"},"LmcRbacMvc")," or\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/spiffyjr/spiffy-authorize"},"SpiffyAuthorize"),"."),(0,o.kt)("p",null,"LmcCors only allows to accept or refuse a cross-origin request."),(0,o.kt)("h2",{id:"custom-schemes"},"Custom schemes"),(0,o.kt)("p",null,"Internally, LmcCors uses ",(0,o.kt)("inlineCode",{parentName:"p"},"Laminas\\Uri\\UriFactory")," class. If you are using custom schemes (for instance if you are\ntesting your API with some Google Chrome extensions), you need to add support for those schemes by adding them to\nthe ",(0,o.kt)("inlineCode",{parentName:"p"},"UriFactory")," config (please ",(0,o.kt)("a",{parentName:"p",href:"https://docs.laminas.dev/laminas-uri/usage/#creating-a-new-custom-class-uri"},"refer to the doc"),")."),(0,o.kt)("h2",{id:"example"},"Example"),(0,o.kt)("p",null,"To register the ",(0,o.kt)("inlineCode",{parentName:"p"},"chrome-extension")," custom scheme in your API, simply add:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"use Laminas\\Uri\\UriFactory;\n\nUriFactory::registerScheme('chrome-extension', 'Laminas\\Uri\\Uri');\n")),(0,o.kt)("p",null,"to the ",(0,o.kt)("inlineCode",{parentName:"p"},"onBootstrap()")," method in ",(0,o.kt)("inlineCode",{parentName:"p"},"module/Application/Module.php"),"."),(0,o.kt)("p",null,"Registering the ",(0,o.kt)("inlineCode",{parentName:"p"},"chrome-extension")," custom scheme like this allows you to use Google Chrome extensions for testing your API."))}p.isMDXComponent=!0}}]);